# üéì LMS Backend API Documentation

**Version:** 2.0 (Refactored)  
**Last Updated:** December 15, 2025  
**Base URL:** `http://127.0.0.1:8000/api`

---

## ‚ö° **CRITICAL: What the Backend Does Automatically**

> [!IMPORTANT]
> **READ THIS FIRST TO AVOID DUPLICATE IMPLEMENTATION**
>
> The backend **AUTOMATICALLY** handles the following logic. **DO NOT reimplement these on the frontend:**
>
> 1. ‚úÖ **Progress Calculation** - Backend calculates percentage automatically based on completed items
> 2. ‚úÖ **Quiz Grading** - Backend calculates scores automatically when quiz is submitted
> 3. ‚úÖ **File Storage** - Backend handles file upload, storage, and URL generation
> 4. ‚úÖ **Authorization** - Backend checks permissions (admin/owner) automatically
> 5. ‚úÖ **Pagination** - Backend paginates course lists automatically
> 6. ‚úÖ **Duplicate Prevention** - Backend prevents duplicate progress records automatically
>
> **Frontend Responsibility:**
> - Send completion events (material viewed, quiz submitted)
> - Display the calculated data returned by backend
> - Handle UI/UX and user interactions
>
> **DO NOT:**
> - Calculate progress percentage on frontend
> - Calculate quiz scores on frontend
> - Implement authorization logic on frontend
> - Store file paths manually

---

## üìã Table of Contents

1. [Overview](#overview)
2. [Backend Automated Features](#backend-automated-features)
3. [Breaking Changes](#breaking-changes)
4. [Authentication](#authentication)
5. [API Response Structure](#api-response-structure)
6. [Rate Limiting](#rate-limiting)
7. [Endpoints](#endpoints)
   - [Authentication](#authentication-endpoints)
   - [Courses](#course-endpoints)
   - [Materials](#material-endpoints)
   - [Quizzes](#quiz-endpoints)
   - [Questions](#question-endpoints)
   - [Quiz Results](#quiz-result-endpoints)
   - [Progress](#progress-endpoints)
   - [Certificates](#certificate-endpoints)
8. [File Uploads](#file-uploads)
9. [Error Handling](#error-handling)
10. [Code Examples](#code-examples)

---

## üîç Overview

This is a RESTful API for the Learning Management System (LMS) built with Laravel 12. The backend provides endpoints for:

- User authentication (register, login, logout)
- Course management with cover images
- Learning materials (PDF, videos, documents)
- Quiz system with **automatic grading**
- Student progress tracking with **automatic percentage calculation**
- Certificate generation

### Technology Stack

- **Framework:** Laravel 12
- **Database:** MySQL
- **Authentication:** Laravel Sanctum (Token-based)
- **File Storage:** Local Storage (Symlink to `storage/app/public`)

---

## ü§ñ Backend Automated Features

### 1. Progress Calculation (AUTOMATIC)

> [!WARNING]
> **DO NOT calculate progress on frontend!**

**How it works:**
- Backend tracks each completed material and quiz individually
- Backend automatically calculates percentage: `(completed_items / total_items) * 100`
- Backend prevents duplicate completion records
- Frontend only needs to **send completion events** and **display the result**

**What Frontend Should Do:**
```javascript
// ‚úÖ CORRECT: Just send the completion event
await fetch('/api/update-progress', {
  method: 'POST',
  body: JSON.stringify({
    course_id: 1,
    material_id: 5,  // or quiz_id: 2
    is_completed: true
  })
});

// Backend returns: { percentage: 45, completed_items: 9, total_items: 20 }
// Just display this data!
```

**What Frontend Should NOT Do:**
```javascript
// ‚ùå WRONG: Don't calculate percentage yourself!
const percentage = (completedCount / totalCount) * 100; // Backend does this!
```

---

### 2. Quiz Grading (AUTOMATIC)

> [!WARNING]
> **DO NOT calculate quiz scores on frontend!**

**How it works:**
- Backend validates all answers against correct answers in database
- Backend calculates score automatically: `(correct_answers / total_questions) * 100`
- Backend stores the result
- Frontend only needs to **submit answers** and **display the score**

**What Frontend Should Do:**
```javascript
// ‚úÖ CORRECT: Just submit the answers
await fetch('/api/submit-quiz', {
  method: 'POST',
  body: JSON.stringify({
    quiz_id: 1,
    answers: [
      { question_id: 1, answer_id: 3 },
      { question_id: 2, answer_id: 7 }
    ]
  })
});

// Backend returns: { score: 85, total_questions: 10 }
// Just display this score!
```

**What Frontend Should NOT Do:**
```javascript
// ‚ùå WRONG: Don't check answers or calculate scores yourself!
const score = answers.filter(a => a.is_correct).length; // Backend does this!
```

---

### 3. File Upload & URL Generation (AUTOMATIC)

**How it works:**
- Backend stores files in `storage/app/public/`
- Backend generates full public URLs automatically
- Frontend receives ready-to-use URLs

**What Frontend Should Do:**
```javascript
// ‚úÖ CORRECT: Just send the file
const formData = new FormData();
formData.append('cover_image', file);

const response = await fetch('/api/courses', {
  method: 'POST',
  body: formData
});

// Backend returns: { cover_image_url: "http://localhost:8000/storage/..." }
// Just use this URL in <img> tag!
```

---

### 4. Authorization (AUTOMATIC)

**How it works:**
- Backend checks if user is admin/owner automatically
- Backend returns 403 error if unauthorized
- Frontend just needs to handle the error

**What Frontend Should Do:**
```javascript
// ‚úÖ CORRECT: Just make the request
try {
  await fetch('/api/courses/1', { method: 'DELETE' });
} catch (error) {
  if (error.status === 403) {
    alert('You are not authorized');
  }
}
```

**What Frontend Should NOT Do:**
```javascript
// ‚ùå WRONG: Don't check permissions yourself!
if (user.role !== 'admin') { // Backend does this!
  return;
}
```

---

## ‚ö†Ô∏è Breaking Changes

> [!WARNING]
> **IMPORTANT: API Response Structure Has Changed**

### Old Response Format (v1.0)
```json
{
  "message": "Success",
  "data": { ... }
}
```

### New Response Format (v2.0)
```json
{
  "success": true,
  "message": "Success",
  "data": { ... }
}
```

### Migration Guide for Frontend

**Before:**
```javascript
const response = await fetch('/api/courses');
const courses = response.data; // ‚ùå Old way
```

**After:**
```javascript
const response = await fetch('/api/courses');
const json = await response.json();
const courses = json.data; // ‚úÖ New way
```

### Other Breaking Changes

1. **Password Confirmation Required**
   - Registration now requires `password_confirmation` field
   - Must match `password` field

2. **Pagination Added**
   - `/api/courses` now returns paginated data
   - Response includes `meta` object with pagination info

3. **User Profile Endpoint**
   - `/api/user` now returns structured response with `success` field

4. **Cover Images**
   - Courses now support cover image upload
   - Response includes `cover_image` and `cover_image_url` fields

---

## üîê Authentication

### Authentication Flow

1. **Register** ‚Üí Get token
2. **Login** ‚Üí Get token
3. **Use token** in `Authorization` header for protected routes
4. **Logout** ‚Üí Revoke token

### Required Headers

**All Requests:**
```http
Accept: application/json
Content-Type: application/json
```

**Protected Routes:**
```http
Accept: application/json
Authorization: Bearer {your_token_here}
```

---

## üìä API Response Structure

### Success Response

```json
{
  "success": true,
  "message": "Operation successful",
  "data": {
    // Response data here
  }
}
```

### Error Response

```json
{
  "success": false,
  "message": "Error message",
  "errors": {
    "field_name": ["Error detail"]
  }
}
```

### Paginated Response

```json
{
  "success": true,
  "message": "List of items",
  "data": [
    // Array of items
  ],
  "meta": {
    "current_page": 1,
    "last_page": 5,
    "per_page": 15,
    "total": 73,
    "from": 1,
    "to": 15
  }
}
```

---

## ‚è±Ô∏è Rate Limiting

### Authentication Endpoints
- **Limit:** 5 requests per minute
- **Endpoints:** `/register`, `/login`
- **Response when exceeded:**
  ```json
  {
    "message": "Too Many Attempts.",
    "exception": "Illuminate\\Http\\Exceptions\\ThrottleRequestsException"
  }
  ```

### Protected Endpoints
- **Limit:** 60 requests per minute
- **All authenticated routes**

---

## üì° Endpoints

### Authentication Endpoints

#### 1. Register New User

**Endpoint:** `POST /api/register`  
**Auth Required:** No  
**Rate Limit:** 5/min

**Request Body:**
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "password_confirmation": "password123",
  "role": "user"
}
```

**Fields:**
- `name` (required, string, max 255)
- `email` (required, email, unique)
- `password` (required, min 8 characters)
- `password_confirmation` (required, must match password)
- `role` (optional, "admin" or "user", default: "user")

**Success Response (201):**
```json
{
  "success": true,
  "message": "Registration successful",
  "data": {
    "user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "role": "user",
      "created_at": "2025-12-15T01:00:00.000000Z",
      "updated_at": "2025-12-15T01:00:00.000000Z"
    },
    "access_token": "1|abc123...",
    "token_type": "Bearer"
  }
}
```

**Error Response (422):**
```json
{
  "message": "The email has already been taken.",
  "errors": {
    "email": ["The email has already been taken."]
  }
}
```

---

#### 2. Login

**Endpoint:** `POST /api/login`  
**Auth Required:** No  
**Rate Limit:** 5/min

**Request Body:**
```json
{
  "email": "john@example.com",
  "password": "password123"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "role": "user",
      "created_at": "2025-12-15T01:00:00.000000Z",
      "updated_at": "2025-12-15T01:00:00.000000Z"
    },
    "access_token": "2|xyz789...",
    "token_type": "Bearer"
  }
}
```

**Error Response (422):**
```json
{
  "message": "The provided credentials are incorrect.",
  "errors": {
    "email": ["The provided credentials are incorrect."]
  }
}
```

---

#### 3. Logout

**Endpoint:** `POST /api/logout`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "Logout successful",
  "data": null
}
```

---

#### 4. Get Current User

**Endpoint:** `GET /api/user`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "John Doe",
    "email": "john@example.com",
    "role": "admin",
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

---

### Course Endpoints

#### 1. Get All Courses (Paginated)

**Endpoint:** `GET /api/courses`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "List of courses",
  "data": [
    {
      "id": 1,
      "title": "Introduction to Laravel",
      "description": "Learn Laravel from scratch",
      "cover_image": "courses/covers/abc123.jpg",
      "cover_image_url": "http://localhost:8000/storage/courses/covers/abc123.jpg",
      "instructor": {
        "id": 1,
        "name": "John Doe"
      },
      "materials_count": 5,
      "quizzes_count": 2,
      "created_at": "2025-12-15T01:00:00.000000Z",
      "updated_at": "2025-12-15T01:00:00.000000Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "last_page": 3,
    "per_page": 15,
    "total": 42,
    "from": 1,
    "to": 15
  }
}
```

---

#### 2. Get Course Details

**Endpoint:** `GET /api/courses/{id}`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "Course details",
  "data": {
    "id": 1,
    "title": "Introduction to Laravel",
    "description": "Learn Laravel from scratch",
    "cover_image": "courses/covers/abc123.jpg",
    "cover_image_url": "http://localhost:8000/storage/courses/covers/abc123.jpg",
    "instructor": {
      "id": 1,
      "name": "John Doe"
    },
    "materials_count": 5,
    "quizzes_count": 2,
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

**Error Response (404):**
```json
{
  "success": false,
  "message": "Course not found"
}
```

---

#### 3. Create Course (Admin Only)

**Endpoint:** `POST /api/courses`  
**Auth Required:** Yes (Admin only)  
**Content-Type:** `multipart/form-data`

**Request Body (FormData):**
```javascript
const formData = new FormData();
formData.append('title', 'Introduction to Laravel');
formData.append('description', 'Learn Laravel from scratch');
formData.append('cover_image', coverImageFile); // Optional
```

**Fields:**
- `title` (required, string, max 255)
- `description` (required, string, max 5000)
- `cover_image` (optional, image file: jpeg/jpg/png/webp, max 2MB)

**Success Response (201):**
```json
{
  "success": true,
  "message": "Course created successfully",
  "data": {
    "id": 1,
    "title": "Introduction to Laravel",
    "description": "Learn Laravel from scratch",
    "cover_image": "courses/covers/abc123.jpg",
    "cover_image_url": "http://localhost:8000/storage/courses/covers/abc123.jpg",
    "instructor": {
      "id": 1,
      "name": "John Doe"
    },
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

**Error Response (403):**
```json
{
  "success": false,
  "message": "This action is unauthorized."
}
```

---

#### 4. Update Course

**Endpoint:** `PUT /api/courses/{id}` or `POST /api/courses/{id}` (with `_method=PUT`)  
**Auth Required:** Yes (Owner or Admin)  
**Content-Type:** `multipart/form-data` (if uploading cover image)

**Request Body (FormData):**
```javascript
const formData = new FormData();
formData.append('title', 'Updated Title');
formData.append('description', 'Updated description');
formData.append('cover_image', newCoverImageFile); // Optional
formData.append('_method', 'PUT'); // Required for POST method
```

**Fields:**
- `title` (optional, string, max 255)
- `description` (optional, string, max 5000)
- `cover_image` (optional, image file: jpeg/jpg/png/webp, max 2MB)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Course updated successfully",
  "data": {
    "id": 1,
    "title": "Updated Title",
    "description": "Updated description",
    "cover_image": "courses/covers/new123.jpg",
    "cover_image_url": "http://localhost:8000/storage/courses/covers/new123.jpg",
    "instructor": {
      "id": 1,
      "name": "John Doe"
    },
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T02:00:00.000000Z"
  }
}
```

---

#### 5. Delete Course

**Endpoint:** `DELETE /api/courses/{id}`  
**Auth Required:** Yes (Owner or Admin)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Course deleted successfully",
  "data": null
}
```

---

#### 6. Delete Course Cover Image

**Endpoint:** `DELETE /api/courses/{id}/cover-image`  
**Auth Required:** Yes (Owner or Admin)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Cover image deleted successfully",
  "data": null
}
```

**Error Response (404):**
```json
{
  "success": false,
  "message": "No cover image to delete"
}
```

---

### Material Endpoints

#### 1. Get Materials by Course

**Endpoint:** `GET /api/materials?course_id={id}`  
**Auth Required:** Yes

**Query Parameters:**
- `course_id` (required, integer)

**Success Response (200):**
```json
{
  "success": true,
  "message": "List of materials",
  "data": [
    {
      "id": 1,
      "course_id": 1,
      "title": "Introduction Video",
      "content_type": "video",
      "content_url": "materials/abc123.mp4",
      "course": {
        "id": 1,
        "title": "Introduction to Laravel"
      },
      "created_at": "2025-12-15T01:00:00.000000Z",
      "updated_at": "2025-12-15T01:00:00.000000Z"
    }
  ]
}
```

---

#### 2. Upload Material (Admin Only)

**Endpoint:** `POST /api/materials`  
**Auth Required:** Yes (Admin only)  
**Content-Type:** `multipart/form-data`

**Request Body (FormData):**
```javascript
const formData = new FormData();
formData.append('course_id', '1');
formData.append('title', 'Introduction Video');
formData.append('content_type', 'video');
formData.append('file', fileObject);
```

**Fields:**
- `course_id` (required, exists in courses)
- `title` (required, string, max 255)
- `content_type` (required, one of: pdf, photo, word, video, ppt, xlsx)
- `file` (required, file, max 10MB)
  - Allowed types: pdf, doc, docx, ppt, pptx, xls, xlsx, mp4, jpg, jpeg, png, webp

**Success Response (201):**
```json
{
  "success": true,
  "message": "Material uploaded successfully",
  "data": {
    "id": 1,
    "course_id": 1,
    "title": "Introduction Video",
    "content_type": "video",
    "content_url": "materials/abc123.mp4",
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

---

#### 3. Delete Material

**Endpoint:** `DELETE /api/materials/{id}`  
**Auth Required:** Yes (Owner or Admin)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Material deleted successfully",
  "data": null
}
```

---

### Quiz Endpoints

#### 1. Get Quizzes by Course

**Endpoint:** `GET /api/quizzes?course_id={id}`  
**Auth Required:** Yes

**Query Parameters:**
- `course_id` (required, integer)

**Success Response (200):**
```json
{
  "success": true,
  "message": "List of quizzes",
  "data": [
    {
      "id": 1,
      "course_id": 1,
      "title": "Laravel Basics Quiz",
      "description": "Test your Laravel knowledge",
      "questions_count": 10,
      "course": {
        "id": 1,
        "title": "Introduction to Laravel"
      },
      "created_at": "2025-12-15T01:00:00.000000Z",
      "updated_at": "2025-12-15T01:00:00.000000Z"
    }
  ]
}
```

---

#### 2. Get Quiz Details (with Questions)

**Endpoint:** `GET /api/quizzes/{id}`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "Quiz details",
  "data": {
    "id": 1,
    "course_id": 1,
    "title": "Laravel Basics Quiz",
    "description": "Test your Laravel knowledge",
    "course": {
      "id": 1,
      "title": "Introduction to Laravel"
    },
    "questions": [
      {
        "id": 1,
        "question_text": "What is Laravel?",
        "answers": [
          {
            "id": 1,
            "answer_text": "A PHP Framework"
          },
          {
            "id": 2,
            "answer_text": "A Database"
          }
        ]
      }
    ],
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

> **Note:** The `is_correct` field is NOT included in answers to prevent cheating.

---

#### 3. Create Quiz (Admin Only)

**Endpoint:** `POST /api/quizzes`  
**Auth Required:** Yes (Admin only)

**Request Body:**
```json
{
  "course_id": 1,
  "title": "Laravel Basics Quiz",
  "description": "Test your Laravel knowledge"
}
```

**Success Response (201):**
```json
{
  "success": true,
  "message": "Quiz created successfully",
  "data": {
    "id": 1,
    "course_id": 1,
    "title": "Laravel Basics Quiz",
    "description": "Test your Laravel knowledge",
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

---

#### 4. Delete Quiz

**Endpoint:** `DELETE /api/quizzes/{id}`  
**Auth Required:** Yes (Owner or Admin)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Quiz deleted successfully",
  "data": null
}
```

---

### Question Endpoints

#### 1. Add Question to Quiz (Admin Only)

**Endpoint:** `POST /api/questions`  
**Auth Required:** Yes (Admin only)

**Request Body:**
```json
{
  "quiz_id": 1,
  "question_text": "What is Laravel?",
  "answers": [
    {
      "answer_text": "A PHP Framework",
      "is_correct": true
    },
    {
      "answer_text": "A Database",
      "is_correct": false
    },
    {
      "answer_text": "A JavaScript Library",
      "is_correct": false
    }
  ]
}
```

**Fields:**
- `quiz_id` (required, exists in quizzes)
- `question_text` (required, string, max 1000)
- `answers` (required, array, min 2, max 6)
  - `answer_text` (required, string, max 500)
  - `is_correct` (required, boolean)

**Validation:**
- At least one answer must be marked as correct

**Success Response (201):**
```json
{
  "success": true,
  "message": "Question and answers added successfully",
  "data": {
    "id": 1,
    "quiz_id": 1,
    "question_text": "What is Laravel?",
    "answers": [
      {
        "id": 1,
        "question_id": 1,
        "answer_text": "A PHP Framework",
        "is_correct": true
      },
      {
        "id": 2,
        "question_id": 1,
        "answer_text": "A Database",
        "is_correct": false
      }
    ],
    "created_at": "2025-12-15T01:00:00.000000Z",
    "updated_at": "2025-12-15T01:00:00.000000Z"
  }
}
```

---

#### 2. Delete Question

**Endpoint:** `DELETE /api/questions/{id}`  
**Auth Required:** Yes (Owner or Admin)

**Success Response (200):**
```json
{
  "success": true,
  "message": "Question deleted",
  "data": null
}
```

---

### Quiz Result Endpoints

#### 1. Submit Quiz Answers

**Endpoint:** `POST /api/submit-quiz`  
**Auth Required:** Yes

**Request Body:**
```json
{
  "quiz_id": 1,
  "answers": [
    {
      "question_id": 1,
      "answer_id": 1
    },
    {
      "question_id": 2,
      "answer_id": 4
    }
  ]
}
```

**Fields:**
- `quiz_id` (required, exists in quizzes)
- `answers` (required, array, min 1)
  - `question_id` (required, exists in questions)
  - `answer_id` (required, exists in answers)

**Success Response (201):**
```json
{
  "success": true,
  "message": "Quiz submitted successfully",
  "data": {
    "quiz_result_id": 1,
    "score": 85,
    "total_questions": 10,
    "completed_at": "2025-12-15T01:30:00.000000Z"
  }
}
```

---

#### 2. Get My Quiz Results

**Endpoint:** `GET /api/my-results`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "Quiz results history",
  "data": [
    {
      "id": 1,
      "quiz": {
        "id": 1,
        "title": "Laravel Basics Quiz",
        "course_id": 1
      },
      "score": 85,
      "completed_at": "2025-12-15T01:30:00.000000Z"
    }
  ]
}
```

---

### Progress Endpoints

> [!IMPORTANT]
> **BACKEND CALCULATES PROGRESS AUTOMATICALLY**
>
> The backend automatically:
> - Tracks each completed material/quiz individually
> - Calculates percentage based on total items in course
> - Prevents duplicate completion records
> - Returns real-time progress data
>
> **Frontend should ONLY:**
> - Send completion events when user finishes a material or quiz
> - Display the percentage returned by backend
> - **NEVER calculate percentage yourself!**

---

#### 1. Update Course Progress (Mark Item as Complete)

**Endpoint:** `POST /api/update-progress`  
**Auth Required:** Yes

**Purpose:** Mark a specific material or quiz as completed. Backend will automatically calculate the new progress percentage.

**Request Body:**
```json
{
  "course_id": 1,
  "material_id": 5,
  "is_completed": true
}
```

**OR** (for quiz completion):
```json
{
  "course_id": 1,
  "quiz_id": 2,
  "is_completed": true
}
```

**Fields:**
- `course_id` (required, integer) - ID of the course
- `material_id` (optional, integer) - ID of material being completed (use this OR quiz_id)
- `quiz_id` (optional, integer) - ID of quiz being completed (use this OR material_id)
- `is_completed` (required, boolean) - Set to `true` when item is completed

> [!NOTE]
> **Anti-Duplication:** If you send the same completion event multiple times, backend will NOT create duplicate records. It's safe to call this endpoint multiple times for the same item.

**Success Response (200):**
```json
{
  "success": true,
  "message": "Progress updated successfully",
  "data": {
    "course_id": 1,
    "percentage": 45,
    "completed_items": 9,
    "total_items": 20
  }
}
```

**Response Fields Explained:**
- `percentage` - **AUTOMATICALLY CALCULATED** by backend: `(completed_items / total_items) * 100`
- `completed_items` - Number of unique materials + quizzes user has completed
- `total_items` - Total number of materials + quizzes in this course

**Frontend Integration Example:**
```javascript
// ‚úÖ CORRECT: When user finishes watching a video
async function markMaterialComplete(courseId, materialId) {
  const response = await fetch('http://localhost:8000/api/update-progress', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      'Accept': 'application/json',
    },
    body: JSON.stringify({
      course_id: courseId,
      material_id: materialId,
      is_completed: true
    })
  });

  const json = await response.json();
  
  // Just display the percentage returned by backend!
  setProgress(json.data.percentage); // e.g., 45
  setCompletedCount(json.data.completed_items); // e.g., 9
  setTotalCount(json.data.total_items); // e.g., 20
}

// ‚ùå WRONG: Don't calculate percentage yourself!
// const percentage = (completed / total) * 100; // Backend does this!
```

**When to Call This Endpoint:**
- ‚úÖ When user finishes viewing a material (video, PDF, etc.)
- ‚úÖ When user completes a quiz (after submitting quiz answers)
- ‚úÖ When user marks a material as "completed" manually
- ‚ùå NOT on page load or navigation
- ‚ùå NOT repeatedly for the same item (backend handles duplicates, but avoid unnecessary calls)

---

#### 2. Get My Progress

**Endpoint:** `GET /api/my-progress`  
**Auth Required:** Yes

**Purpose:** Get list of all completed items across all courses for the current user.

**Success Response (200):**
```json
{
  "success": true,
  "message": "Progress history",
  "data": [
    {
      "id": 1,
      "user_id": 1,
      "course_id": 1,
      "material_id": 5,
      "quiz_id": null,
      "is_completed": true,
      "status": "completed",
      "course": {
        "id": 1,
        "title": "Introduction to Laravel"
      }
    },
    {
      "id": 2,
      "user_id": 1,
      "course_id": 1,
      "material_id": null,
      "quiz_id": 2,
      "is_completed": true,
      "status": "completed",
      "course": {
        "id": 1,
        "title": "Introduction to Laravel"
      }
    }
  ]
}
```

**Use Case:** Display user's learning history or completed items list.

**Frontend Integration Example:**
```javascript
// Get all completed items
const response = await fetch('http://localhost:8000/api/my-progress', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json',
  }
});

const json = await response.json();
const completedItems = json.data;

// Group by course if needed
const byCourse = completedItems.reduce((acc, item) => {
  if (!acc[item.course_id]) {
    acc[item.course_id] = [];
  }
  acc[item.course_id].push(item);
  return acc;
}, {});
```

---

### Certificate Endpoints

#### 1. Claim Certificate

**Endpoint:** `POST /api/claim-certificate`  
**Auth Required:** Yes

**Request Body:**
```json
{
  "course_id": 1
}
```

**Requirements:**
- User must have completed the course (status = "complete")

**Success Response (201):**
```json
{
  "success": true,
  "message": "Certificate issued successfully!",
  "data": {
    "id": 1,
    "user_id": 1,
    "course_id": 1,
    "certificate_code": "CERT-2025-ABC12345",
    "certificate_url": "http://localhost:8000/certificates/view/CERT-2025-ABC12345",
    "issued_at": "2025-12-15T02:00:00.000000Z"
  }
}
```

**Error Response (403):**
```json
{
  "success": false,
  "message": "Cannot claim certificate. Please complete the course first."
}
```

---

#### 2. Get My Certificates

**Endpoint:** `GET /api/my-certificates`  
**Auth Required:** Yes

**Success Response (200):**
```json
{
  "success": true,
  "message": "List of certificates",
  "data": [
    {
      "id": 1,
      "certificate_code": "CERT-2025-ABC12345",
      "certificate_url": "http://localhost:8000/certificates/view/CERT-2025-ABC12345",
      "course": {
        "id": 1,
        "title": "Introduction to Laravel"
      },
      "issued_at": "2025-12-15T02:00:00.000000Z"
    }
  ]
}
```

---

## üì§ File Uploads

### Cover Image Upload (Courses)

**Supported Formats:** JPEG, JPG, PNG, WebP  
**Max Size:** 2MB  
**Storage Path:** `storage/app/public/courses/covers/`

**Example:**
```javascript
const formData = new FormData();
formData.append('title', 'Course Title');
formData.append('description', 'Description');
formData.append('cover_image', coverImageFile);

const response = await fetch('http://localhost:8000/api/courses', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json',
  },
  body: formData, // Don't set Content-Type header
});
```

### Material File Upload

**Supported Formats:**
- Documents: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX
- Videos: MP4
- Images: JPG, JPEG, PNG, WebP

**Max Size:** 10MB  
**Storage Path:** `storage/app/public/materials/`

**Example:**
```javascript
const formData = new FormData();
formData.append('course_id', '1');
formData.append('title', 'Lesson 1 Video');
formData.append('content_type', 'video');
formData.append('file', videoFile);

const response = await fetch('http://localhost:8000/api/materials', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json',
  },
  body: formData,
});
```

---

## ‚ùå Error Handling

### HTTP Status Codes

- `200` - Success
- `201` - Created
- `400` - Bad Request
- `401` - Unauthorized (missing/invalid token)
- `403` - Forbidden (insufficient permissions)
- `404` - Not Found
- `422` - Validation Error
- `429` - Too Many Requests (rate limit exceeded)
- `500` - Server Error

### Validation Errors (422)

```json
{
  "message": "The given data was invalid.",
  "errors": {
    "email": [
      "The email field is required.",
      "The email must be a valid email address."
    ],
    "password": [
      "The password must be at least 8 characters."
    ]
  }
}
```

### Authorization Errors (403)

```json
{
  "success": false,
  "message": "This action is unauthorized."
}
```

### Rate Limit Errors (429)

```json
{
  "message": "Too Many Attempts.",
  "exception": "Illuminate\\Http\\Exceptions\\ThrottleRequestsException"
}
```

---

## üíª Code Examples

### React/Next.js Integration

#### 1. Authentication Hook

```javascript
// hooks/useAuth.js
import { useState, useEffect } from 'react';

export function useAuth() {
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(null);

  useEffect(() => {
    const savedToken = localStorage.getItem('token');
    if (savedToken) {
      setToken(savedToken);
      fetchUser(savedToken);
    }
  }, []);

  const fetchUser = async (authToken) => {
    try {
      const response = await fetch('http://localhost:8000/api/user', {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Accept': 'application/json',
        },
      });
      const json = await response.json();
      if (json.success) {
        setUser(json.data);
      }
    } catch (error) {
      console.error('Failed to fetch user:', error);
    }
  };

  const login = async (email, password) => {
    try {
      const response = await fetch('http://localhost:8000/api/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
        },
        body: JSON.stringify({ email, password }),
      });

      const json = await response.json();

      if (json.success) {
        const { access_token, user } = json.data;
        setToken(access_token);
        setUser(user);
        localStorage.setItem('token', access_token);
        return { success: true };
      } else {
        return { success: false, message: json.message };
      }
    } catch (error) {
      return { success: false, message: error.message };
    }
  };

  const logout = async () => {
    try {
      await fetch('http://localhost:8000/api/logout', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/json',
        },
      });
    } catch (error) {
      console.error('Logout error:', error);
    } finally {
      setToken(null);
      setUser(null);
      localStorage.removeItem('token');
    }
  };

  return { user, token, login, logout };
}
```

---

#### 2. Fetch Courses with Pagination

```javascript
// components/CourseList.jsx
import { useState, useEffect } from 'react';

export function CourseList({ token }) {
  const [courses, setCourses] = useState([]);
  const [pagination, setPagination] = useState(null);
  const [loading, setLoading] = useState(true);

  const fetchCourses = async (page = 1) => {
    setLoading(true);
    try {
      const response = await fetch(`http://localhost:8000/api/courses?page=${page}`, {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/json',
        },
      });

      const json = await response.json();

      if (json.success) {
        setCourses(json.data);
        setPagination(json.meta);
      }
    } catch (error) {
      console.error('Failed to fetch courses:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchCourses();
  }, []);

  if (loading) return <div>Loading...</div>;

  return (
    <div>
      <div className="courses-grid">
        {courses.map(course => (
          <div key={course.id} className="course-card">
            {course.cover_image_url && (
              <img src={course.cover_image_url} alt={course.title} />
            )}
            <h3>{course.title}</h3>
            <p>{course.description}</p>
            <p>Instructor: {course.instructor.name}</p>
            <p>Materials: {course.materials_count}</p>
            <p>Quizzes: {course.quizzes_count}</p>
          </div>
        ))}
      </div>

      {pagination && (
        <div className="pagination">
          <button
            disabled={pagination.current_page === 1}
            onClick={() => fetchCourses(pagination.current_page - 1)}
          >
            Previous
          </button>
          <span>
            Page {pagination.current_page} of {pagination.last_page}
          </span>
          <button
            disabled={pagination.current_page === pagination.last_page}
            onClick={() => fetchCourses(pagination.current_page + 1)}
          >
            Next
          </button>
        </div>
      )}
    </div>
  );
}
```

---

#### 3. Create Course with Cover Image

```javascript
// components/CreateCourseForm.jsx
import { useState } from 'react';

export function CreateCourseForm({ token, onSuccess }) {
  const [formData, setFormData] = useState({
    title: '',
    description: '',
  });
  const [coverImage, setCoverImage] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    const data = new FormData();
    data.append('title', formData.title);
    data.append('description', formData.description);
    if (coverImage) {
      data.append('cover_image', coverImage);
    }

    try {
      const response = await fetch('http://localhost:8000/api/courses', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/json',
        },
        body: data,
      });

      const json = await response.json();

      if (json.success) {
        onSuccess(json.data);
        setFormData({ title: '', description: '' });
        setCoverImage(null);
      } else {
        setError(json.message);
      }
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        placeholder="Course Title"
        value={formData.title}
        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
        required
      />

      <textarea
        placeholder="Course Description"
        value={formData.description}
        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
        required
      />

      <input
        type="file"
        accept="image/jpeg,image/jpg,image/png,image/webp"
        onChange={(e) => setCoverImage(e.target.files[0])}
      />

      {error && <div className="error">{error}</div>}

      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create Course'}
      </button>
    </form>
  );
}
```

---

#### 4. Submit Quiz

```javascript
// components/QuizTaker.jsx
import { useState } from 'react';

export function QuizTaker({ quiz, token, onComplete }) {
  const [answers, setAnswers] = useState({});
  const [loading, setLoading] = useState(false);

  const handleAnswerSelect = (questionId, answerId) => {
    setAnswers({
      ...answers,
      [questionId]: answerId,
    });
  };

  const handleSubmit = async () => {
    setLoading(true);

    const answersArray = Object.entries(answers).map(([questionId, answerId]) => ({
      question_id: parseInt(questionId),
      answer_id: parseInt(answerId),
    }));

    try {
      const response = await fetch('http://localhost:8000/api/submit-quiz', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
          'Accept': 'application/json',
        },
        body: JSON.stringify({
          quiz_id: quiz.id,
          answers: answersArray,
        }),
      });

      const json = await response.json();

      if (json.success) {
        onComplete(json.data);
      }
    } catch (error) {
      console.error('Failed to submit quiz:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="quiz-taker">
      <h2>{quiz.title}</h2>
      <p>{quiz.description}</p>

      {quiz.questions.map((question) => (
        <div key={question.id} className="question">
          <h3>{question.question_text}</h3>
          {question.answers.map((answer) => (
            <label key={answer.id}>
              <input
                type="radio"
                name={`question-${question.id}`}
                value={answer.id}
                onChange={() => handleAnswerSelect(question.id, answer.id)}
              />
              {answer.answer_text}
            </label>
          ))}
        </div>
      ))}

      <button
        onClick={handleSubmit}
        disabled={loading || Object.keys(answers).length !== quiz.questions.length}
      >
        {loading ? 'Submitting...' : 'Submit Quiz'}
      </button>
    </div>
  );
}
```

---

## üîß Environment Setup

### Backend `.env` Configuration

```env
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=mcourses_db
DB_USERNAME=root
DB_PASSWORD=

SANCTUM_STATEFUL_DOMAINS=localhost:3000
SESSION_DOMAIN=localhost
```

### Frontend Configuration

Create an API client:

```javascript
// lib/api.js
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api';

export async function apiRequest(endpoint, options = {}) {
  const token = localStorage.getItem('token');

  const headers = {
    'Accept': 'application/json',
    ...options.headers,
  };

  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }

  if (options.body && !(options.body instanceof FormData)) {
    headers['Content-Type'] = 'application/json';
    options.body = JSON.stringify(options.body);
  }

  const response = await fetch(`${API_BASE_URL}${endpoint}`, {
    ...options,
    headers,
  });

  const json = await response.json();

  if (!response.ok) {
    throw new Error(json.message || 'Request failed');
  }

  return json;
}
```

---

## üìû Support

For questions or issues, contact the backend development team.

**Backend Repository:** https://github.com/ax71/Project-class-V2

---

**Last Updated:** December 15, 2025  
**API Version:** 2.0

---

## üìå Quick Reference Guide

### Backend Responsibilities (AUTOMATIC)

| Feature | Backend Does | Frontend Should Do | Frontend Should NOT Do |
|---------|--------------|-------------------|----------------------|
| **Progress Calculation** | ‚úÖ Calculates percentage automatically | Send completion events, display percentage | ‚ùå Calculate percentage |
| **Quiz Grading** | ‚úÖ Validates answers, calculates score | Submit answers, display score | ‚ùå Check answers or calculate score |
| **File Upload** | ‚úÖ Stores files, generates URLs | Send files via FormData, display URLs | ‚ùå Generate file paths |
| **Authorization** | ‚úÖ Checks admin/owner permissions | Handle 403 errors gracefully | ‚ùå Check permissions before request |
| **Pagination** | ‚úÖ Paginates course lists | Display paginated data, handle page changes | ‚ùå Implement pagination logic |
| **Duplicate Prevention** | ‚úÖ Prevents duplicate progress records | Call endpoints normally | ‚ùå Track completion state manually |

---

## ‚ö†Ô∏è Common Mistakes to Avoid

### 1. Calculating Progress on Frontend

```javascript
// ‚ùå WRONG - Don't do this!
const completedMaterials = materials.filter(m => m.completed).length;
const totalMaterials = materials.length;
const percentage = (completedMaterials / totalMaterials) * 100;

// ‚úÖ CORRECT - Let backend calculate
const response = await fetch('/api/update-progress', {
  method: 'POST',
  body: JSON.stringify({
    course_id: 1,
    material_id: 5,
    is_completed: true
  })
});
const { percentage } = response.data; // Use this!
```

---

### 2. Calculating Quiz Scores on Frontend

```javascript
// ‚ùå WRONG - Don't do this!
const correctAnswers = userAnswers.filter(a =>
  questions.find(q => q.id === a.question_id)
    .answers.find(ans => ans.id === a.answer_id).is_correct
).length;
const score = (correctAnswers / questions.length) * 100;

// ‚úÖ CORRECT - Let backend calculate
const response = await fetch('/api/submit-quiz', {
  method: 'POST',
  body: JSON.stringify({
    quiz_id: 1,
    answers: userAnswers
  })
});
const { score } = response.data; // Use this!
```

---

### 3. Checking Permissions Before Request

```javascript
// ‚ùå WRONG - Don't do this!
if (user.role !== 'admin') {
  alert('You are not authorized');
  return;
}
await deleteCourse(courseId);

// ‚úÖ CORRECT - Let backend check
try {
  await deleteCourse(courseId);
} catch (error) {
  if (error.status === 403) {
    alert('You are not authorized');
  }
}
```

---

### 4. Manually Tracking Completion State

```javascript
// ‚ùå WRONG - Don't do this!
const [completedMaterials, setCompletedMaterials] = useState(new Set());

function markComplete(materialId) {
  if (!completedMaterials.has(materialId)) {
    setCompletedMaterials(prev => new Set([...prev, materialId]));
    // Then call API...
  }
}

// ‚úÖ CORRECT - Backend handles duplicates
function markComplete(materialId) {
  // Just call the API, backend prevents duplicates
  await fetch('/api/update-progress', {
    method: 'POST',
    body: JSON.stringify({
      course_id: 1,
      material_id: materialId,
      is_completed: true
    })
  });
}
```

---

## üìû Support

For questions or issues, contact the backend development team.

**Backend Repository:** https://github.com/ax71/Project-class-V2

---

**Last Updated:** December 15, 2025  
**API Version:** 2.0

---

## üìö Additional Notes (Legacy Documentation)

The following section contains legacy documentation in Indonesian for reference:

---

Repository ini berisi source code Backend untuk aplikasi Learning Management System. Dibangun menggunakan **Laravel 12**, menyediakan RESTful API untuk manajemen kursus, kuis, progres siswa, hingga penerbitan sertifikat.

## üõ†Ô∏è Teknologi

-   **Framework:** Laravel 12
-   **Database:** MySQL

---

## üöÄ Cara Install & Menjalankan (Local)

Untuk menjalankan backend ini di komputer lokal, ikuti langkah berikut:

1.  **Clone Repository**

    ```bash
    git clone https://github.com/ax71/Project-class-V2.git
    cd Project-class-V2
    ```

2.  **Install Dependencies**

    ```bash
    composer install
    ```

3.  **Setup Environment**

    -   Copy file `.env.example` menjadi `.env`.
    -   Sesuaikan setting database di file `.env`:

    ```env
    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=nama_database_anda
    DB_USERNAME=root
    DB_PASSWORD=
    ```

4.  **Generate Key & Migrate**

    ```bash
    php artisan key:generate
    php artisan migrate
    ```

5.  **Setup Storage (Wajib untuk File Materi & Sertifikat)**
    Agar file yang diupload bisa diakses publik (frontend):

    ```bash
    php artisan storage:link
    ```

6.  **Jalankan Server**
    ```bash
    php artisan serve
    ```
    API akan berjalan di: `http://127.0.0.1:8000/api`

---

## üîê Aturan Request API

1.  **Headers Wajib:**
    Setiap request harus menyertakan header ini agar return berupa JSON (bukan HTML):

    ```http
    Accept: application/json
    ```

2.  **Authentication:**
    Untuk endpoint yang diproteksi (Protected Routes), tambahkan Token di Header:
    ```http
    Authorization: Bearer <access_token>
    ```

---

## üìö Dokumentasi Endpoint

### 1. Authentication

| Method | Endpoint    | Deskripsi              | Body (JSON)                                          |
| :----- | :---------- | :--------------------- | :--------------------------------------------------- |
| `POST` | `/register` | Daftar User Baru       | `name`, `email`, `password`, `role` ('admin'/'user') |
| `POST` | `/login`    | Masuk & Dapat Token    | `email`, `password`                                  |
| `POST` | `/logout`   | Hapus Token (Auth)     | -                                                    |
| `GET`  | `/user`     | Cek Profil Saya (Auth) | -                                                    |

### 2. Courses (Kursus)

| Method   | Endpoint        | Deskripsi           | Body                   |
| :------- | :-------------- | :------------------ | :--------------------- |
| `GET`    | `/courses`      | List Semua Kursus   | -                      |
| `POST`   | `/courses`      | Buat Kursus (Admin) | `title`, `description` |
| `GET`    | `/courses/{id}` | Detail Kursus       | -                      |
| `PUT`    | `/courses/{id}` | Edit Kursus         | `title`, `description` |
| `DELETE` | `/courses/{id}` | Hapus Kursus        | -                      |

### 3. Materials (Materi Belajar)

_Catatan: Gunakan `form-data` untuk upload file._

| Method   | Endpoint          | Deskripsi              | Body (Form-Data)                                         |
| :------- | :---------------- | :--------------------- | :------------------------------------------------------- |
| `GET`    | `/materials`      | List Materi per Course | Query Param: `?course_id=1`                              |
| `POST`   | `/materials`      | Upload Materi          | `course_id`, `title`, `content_type` (pdf/video), `file` |
| `DELETE` | `/materials/{id}` | Hapus Materi           | -                                                        |

### 4. Quiz System (Ujian)

| Method | Endpoint        | Deskripsi             | Body (JSON)                         |
| :----- | :-------------- | :-------------------- | :---------------------------------- |
| `GET`  | `/quizzes`      | List Kuis per Course  | Query Param: `?course_id=1`         |
| `POST` | `/quizzes`      | Buat Judul Kuis       | `course_id`, `title`, `description` |
| `GET`  | `/quizzes/{id}` | Detail Soal & Jawaban | -                                   |
| `POST` | `/questions`    | Tambah Soal + Jawaban | _Lihat contoh JSON di bawah_        |

**Contoh JSON Tambah Soal (`POST /questions`):**

```json
{
    "quiz_id": 1,
    "question_text": "Apa nama ibukota Indonesia?",
    "answers": [
        { "answer_text": "Jakarta", "is_correct": true },
        { "answer_text": "Bandung", "is_correct": false }
    ]
}
```
